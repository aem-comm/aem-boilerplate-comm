/*! Copyright 2024 Adobe
All Rights Reserved. */
import{jsx as d,jsxs as P}from"@dropins/tools/preact-jsx-runtime.js";import{Card as h,Header as x}from"@dropins/tools/components.js";import"../chunks/OrderCancel.js";import{classes as q}from"@dropins/tools/lib.js";import{useState as C,useEffect as L,useMemo as R}from"@dropins/tools/preact-hooks.js";import{events as T}from"@dropins/tools/event-bus.js";import{s as S}from"../chunks/setTaxStatus.js";import{g as b}from"../chunks/getStoreConfig.js";import{Fragment as I}from"@dropins/tools/preact.js";import"@dropins/tools/preact-compat.js";import{a as N}from"../chunks/OrderLoaders.js";import{C as Q}from"../chunks/CartSummaryItem.js";import{useText as k}from"@dropins/tools/i18n.js";import"../chunks/fetch-graphql.js";import"@dropins/tools/fetch-graphql.js";const M=({orderData:i})=>{const[l,e]=C(!0),[c,s]=C(i),[t,a]=C({taxIncluded:!1,taxExcluded:!1}),[n,f]=C("");return L(()=>{b().then(r=>{if(r){const o=S(r==null?void 0:r.shoppingCartDisplayPrice);a(o),f(r.baseMediaUrl)}}).finally(()=>{e(!1)})},[]),L(()=>{const r=T.on("order/data",o=>{s(o)},{eager:!0});return()=>{r==null||r.off()}},[]),{loading:l,taxConfig:t,order:{...c,placeholderImage:n}}},v=i=>{const l=(i==null?void 0:i.items)??[],e=l.filter(t=>(t==null?void 0:t.eligibleForReturn)&&(t==null?void 0:t.quantityReturnRequested)).map(t=>({...t,totalQuantity:t.quantityReturnRequested})),c=new Map(e.map(t=>[t.id,t])),s=l.map(t=>{const a=c.get(t==null?void 0:t.id);if(a){const n=t.totalQuantity-a.quantityReturnRequested;return n===0?null:{...t,totalQuantity:n}}return t}).filter(t=>t!==null);return{returnedList:e,canceledItems:s==null?void 0:s.filter(t=>t.quantityCanceled),nonCanceledItems:s==null?void 0:s.filter(t=>!t.quantityCanceled)}},w=({loading:i,taxConfig:l,order:e=null,withHeader:c=!0,showConfigurableOptions:s,routeProductDetails:t})=>{const a=!!(e!=null&&e.returnNumber),n=k({cancelled:"Order.OrderProductListContent.cancelledTitle",allOrders:"Order.OrderProductListContent.allOrdersTitle",returned:"Order.OrderProductListContent.returnedTitle",refunded:"Order.OrderProductListContent.refundedTitle",sender:"Order.OrderProductListContent.GiftCard.sender",recipient:"Order.OrderProductListContent.GiftCard.recipient",message:"Order.OrderProductListContent.GiftCard.message",outOfStock:"Order.OrderProductListContent.stockStatus.outOfStock",downloadableCount:"Order.OrderProductListContent.downloadableCount"}),f=R(()=>{var o,p;if(!e)return[];if(!a){const{returnedList:u,canceledItems:m,nonCanceledItems:g}=v(e);return[{type:"returned",list:u,title:n.returned},{type:"cancelled",list:m,title:n.cancelled},{type:"allItems",list:g,title:n.allOrders}].filter(O=>{var y;return((y=O==null?void 0:O.list)==null?void 0:y.length)>0})}return[{type:"returned",list:((p=(o=e.returns.find(u=>u.returnNumber===(e==null?void 0:e.returnNumber)))==null?void 0:o.items)==null?void 0:p.map(u=>({...u,totalQuantity:u.requestQuantity})))??[],title:n.returned}]},[e,a,n]);return e?f.every(r=>r.list.length===0)?null:d(h,{variant:"secondary",className:"order-order-product-list-content",children:f.map((r,o)=>{var u;const p=r.list.reduce((m,{totalQuantity:g})=>g+m,0);return P(I,{children:[c?d(x,{title:`${r.title} (${p})`}):null,d("ul",{className:"order-order-product-list-content__items",children:(u=r.list)==null?void 0:u.map(m=>d("li",{"data-testid":"order-product-list-content-item",children:d(Q,{placeholderImage:e==null?void 0:e.placeholderImage,loading:i,product:m,itemType:r.type,taxConfig:l,translations:n,showConfigurableOptions:s,routeProductDetails:t})},m.id))})]},o)})}):d(N,{})},W=({className:i,orderData:l,withHeader:e,showConfigurableOptions:c,routeProductDetails:s})=>{const{loading:t,taxConfig:a,order:n}=M({orderData:l});return d("div",{className:q(["order-order-product-list",i]),children:d(w,{loading:t,taxConfig:a,order:n,withHeader:e,showConfigurableOptions:c,routeProductDetails:s})})};export{W as OrderProductList,W as default};
